---
layout: post
title: "A simple note of MATLAB"
categories: 教程
---

# Matlab速记

### 一些小命令

```matlab
isnan(a)%用于判断a是不是NaN，如果是则返回1，不是则返回0

cov(A)%返回A的协方差矩阵，A的列数视为协方差阵的大小

[V,D] = eig(B)%对方阵B进行特征值分解，V储存特征向量，D储存特征值

[value,idx] = max(C)%C为一列列表，返回其最大值及其对应的索引
[~,idx] = max(C)%这样就只返回索引

sort(C)%对C进行升序排列
sort(C,'descend')%对C进行降序排列
```



### 使用solve求解数值方程

对于一些符号表达式，如何求解其精确结果或精确数值结果，首先定义对应的符号变量，x为自变量

```matlab
syms a b c d x
```

假设存在以下表达，这些表达既可以是简单的运算，也可以是复杂的运算，如指数自变量，复杂函数sin等，但是他们必须是由上述五个符号表达的

```matlab
f,g
```

下面对这些符号表达式传入数值

```matlab
para_val = [1,2,3,4];
f_nmc = subs(f,[a,b,c,d],para_val);
g_nmc = subs(g,[a,b,c,d],para_val);
```

在以上的_nmc变量中，所有的系数都是精确表达，只剩下了x这个符号。就可以使用solve求解器求解这个方程，注意表明条件 ==0 与自变量x。

```matlab
root_1 = solve(f_nmc == 0, x);
root_2 = solve(g_nmc == 0, x);
```

### 使用vpasolve求解方程组

假设我现在有一系列的方程，这些方程都是由数值加符号变量表示的，如

```matlab 
eq1 = 3*x1 + 5*x2 + 9*x3 - 7*x4;
eq2
eq3
eq4
```

其中系数都是精确的数值表达，xi是对应的符号表达，如何求解满足以上四个equation的对应的xi们？可以使用vpasolve的方法，首先，应该定义一个变量eqs，这个变量eqs用来储存待解决的线性方程组

```matlab
eqs = [eq1 == 0, eq2 == 0, eq3 == 0, eq4 == 0];
```

然后就是使用vpasolve求解这个线性方程组

```matlab
solutions = vpasolve(eqs,[x1,x2,x3,x4]);
```

这样可以得到一个结构体变量solutions，这个变量里储存了对应的xi的信息，下面应该提取对应的字段，储存在一个double变量中，以方便以后的调用

```matlab
fields = {'x1','x2','x3','x4'};
x_nmc = zeros(1,numel(fields));%numel()计算了一个结构中元素的个数
syms x_nmc
for i = 1:numel(fields)
	x_nmc(i) = double(solutions.(fields{i}));
end
```

这样就将对应的解储存在了x_nmc变量中，double类型

###  matlab的回归库

X为数据矩阵，可以是一列或者好几列
y待回归变量，只能是一列

```matlab
rgs = fitlm(X,y)
disp(rgs)
```

这样就构造了简单了回归模型，并且输出了对应的回归报告，回归报告中索引为1的参数是结局Intercept，之后的为数据矩阵X中对应的变量

![image-20241229185858682]({{'../assets/images/posts/Matlab/image-20241229185858682.jpg' | relative_url}})

以上就是一个随机的回归结果，这里有一个结局intercept和三个变量。如果只想要输出一些参数，而不想输出整个回归报告的话，这里可以使用点索引的形式访问参数，比如我现在想要访问x2对应的SE

```matlab
rgs.Coefficients.SE(3)
```

### 导入数据以及table变量的介绍

在古老版本的matlab导入数据通常使用`xlsread`
但现在matlab更推荐的导入数据方式使用的是`readtable`命令。以下先通过一个引例说明`readtable`的使用

```matlab
opts = detectImportOptions('HW4_Data1.xlsx');%检测这个xlsx文件的导入选项
opts.VariableNamingRule = 'preserve';%保留原有的变量名
data_origin = readtable('HW4_Data1.xlsx',opts);
data = table2array(data_origin);%这里由于这个xlsx文件只有数值型变量，因此这个转化直接构建了一个double型的data变量，以便于对数值上的操作，如果有其他的非数值型变量这个命令就会失效
```

或者使用以下的命令，避免`opt`的设置

```matlab
T_preserve = readtable('sampletable.txt','VariableNamingRule','preserve');
```

如果需要对导入列进行命名，则使用以下命令

```matlab
A = ones(3,3)
T = array2table(A,'VariableNames',{'column1','column2','column3'})
```

如果特定导入工作表，如工作表的名称为Data，则使用以下方式

```matlab	
T = readtable('example.xlsx','sheet','Data');
```

当你导入了一个table之后，第一步便是检查你这个table变量每列都是什么类型的数据，假设table变量名称为T，我们在之后一直延续这个名称

```matlAB
varfun(@class,T)
```

这样就会在命令行直接检视到table变量的数据类型，一般的数据类型为一列datetime变量，和很多列的double变量。注意，如果在原始数据某列中存在混合变量的使用，则readtable指令默认把这列导入为cell变量

倘若我想访问一列变量，使用点索引的格式，首先查询table的变量名

```matlab 
T.Properties.VariableNames
```

其输出为

```matlab
  {'Month'}    {'Year'}    {'Australia'} 
```

通过点索引的形式访问

```matlab
T.Australia
```

这样就可以得到对应的数据列，其变量类型不变

### matlab绘制图像

通过`figure` `hold on` `hold off`来控制绘制图片的次序，以下是一个具体的实例

```matlab
figure;%绘制第一张图
plot(monthlyVolatility.Month, monthlyVolatility.jp, 'DisplayName', 'Japan');
hold on;%控制别动
plot(monthlyVolatility.Month, monthlyVolatility.us, 'DisplayName', 'US');
plot(monthlyVolatility.Month, monthlyVolatility.gc, 'DisplayName', 'GC');
legend('Location', 'best');%添加图例
xlabel('Month');%横轴名称
ylabel('Volatility');%纵轴名称
title('Monthly Volatility Time Series');%图片标题
grid on;%是否显示网格
hold off%解除控制
```





